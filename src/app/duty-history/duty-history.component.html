<div class="duty-history-container">
  <!-- é é¢æ¨™é¡Œ -->
  <div class="page-header">
    <div class="header-left">
      <button class="back-btn" (click)="goBack()">
        <span class="back-icon">â†</span>
        å›åˆ°å€¼ç­æ—¥æ›†
      </button>
    </div>
    <h1 class="page-title">å€¼ç­ç•°å‹•æ­·å²</h1>
    <div class="header-right">
      <button class="export-btn" (click)="exportToCSV()" *ngIf="filteredChanges.length > 0">
        ğŸ“¥ åŒ¯å‡º CSV
      </button>
    </div>
  </div>

  <!-- ç¯©é¸å·¥å…·åˆ— -->
  <div class="filter-toolbar">
    <div class="filter-group">
      <label>å€¼ç­é¡å‹ï¼š</label>
      <select [(ngModel)]="filterType" (change)="applyFilters()">
        <option value="all">å…¨éƒ¨</option>
        <option value="normal">ä¸€èˆ¬å€¼ç­</option>
        <option value="uat">UATæ¸¬è³‡</option>
      </select>
    </div>

    <div class="filter-group">
      <label>äººå“¡æœå°‹ï¼š</label>
      <input type="text" 
             [(ngModel)]="filterPerson" 
             (input)="applyFilters()" 
             placeholder="è¼¸å…¥äººå“¡å§“å...">
    </div>

    <div class="filter-group">
      <label>æ—¥æœŸæœˆä»½ï¼š</label>
      <input type="month" 
             [(ngModel)]="filterDateRange" 
             (change)="applyFilters()">
    </div>

    <div class="filter-group">
      <label>æ’åºï¼š</label>
      <select [(ngModel)]="sortBy" (change)="applyFilters()">
        <option value="changeTime">ç•°å‹•æ™‚é–“</option>
        <option value="date">å€¼ç­æ—¥æœŸ</option>
        <option value="person">äººå“¡å§“å</option>
      </select>
      <select [(ngModel)]="sortOrder" (change)="applyFilters()">
        <option value="desc">éæ¸›</option>
        <option value="asc">éå¢</option>
      </select>
    </div>

    <div class="filter-actions">
      <button class="clear-btn" (click)="clearFilters()">æ¸…é™¤ç¯©é¸</button>
    </div>
  </div>

  <!-- çµ±è¨ˆè³‡è¨Š -->
  <div class="stats-bar">
    <div class="stats-item">
      <span class="stats-label">ç¸½ç•°å‹•è¨˜éŒ„ï¼š</span>
      <span class="stats-value">{{ dutyChanges.length }}</span>
    </div>
    <div class="stats-item">
      <span class="stats-label">ç¯©é¸çµæœï¼š</span>
      <span class="stats-value">{{ filteredChanges.length }}</span>
    </div>
    <div class="stats-item">
      <span class="stats-label">ä¸€èˆ¬å€¼ç­ï¼š</span>
      <span class="stats-value">{{ (dutyChanges | filter:'dutyType':'normal').length || 0 }}</span>
    </div>
    <div class="stats-item">
      <span class="stats-label">UATæ¸¬è³‡ï¼š</span>
      <span class="stats-value">{{ (dutyChanges | filter:'dutyType':'uat').length || 0 }}</span>
    </div>
  </div>

  <!-- ç•°å‹•è¨˜éŒ„è¡¨æ ¼ -->
  <div class="table-container" *ngIf="filteredChanges.length > 0; else noDataTemplate">
    <table class="history-table">
      <thead>
        <tr>
          <th>å€¼ç­æ—¥æœŸ</th>
          <th>é¡å‹</th>
          <th>åŸè² è²¬äºº</th>
          <th>æ–°è² è²¬äºº</th>
          <th>ç•°å‹•è€…</th>
          <th>ç•°å‹•æ™‚é–“</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let change of getPaginatedChanges(); let i = index" 
            [class.even-row]="i % 2 === 0">
          <td class="date-cell">{{ formatDate(change.date) }}</td>
          <td class="type-cell">
            <span class="duty-type-badge" 
                  [class.normal-type]="change.dutyType === 'normal'"
                  [class.uat-type]="change.dutyType === 'uat'">
              {{ getDutyTypeName(change.dutyType) }}
            </span>
          </td>
          <td class="person-cell original">{{ change.originalPerson }}</td>
          <td class="person-cell new">
            <span class="arrow">â†’</span>
            {{ change.newPerson }}
          </td>
          <td class="changer-cell">{{ change.changedBy }}</td>
          <td class="time-cell">{{ formatDateTime(change.changedAt) }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ç„¡è³‡æ–™é¡¯ç¤º -->
  <ng-template #noDataTemplate>
    <div class="no-data">
      <div class="no-data-icon">ğŸ“‹</div>
      <div class="no-data-message">
        <h3>ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ç•°å‹•è¨˜éŒ„</h3>
        <p>èª¿æ•´ç¯©é¸æ¢ä»¶æˆ–æ¸…é™¤ç¯©é¸ä¾†æŸ¥çœ‹æ›´å¤šè³‡æ–™</p>
      </div>
    </div>
  </ng-template>

  <!-- åˆ†é æ§åˆ¶ -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button class="page-btn" 
            [disabled]="currentPage === 1" 
            (click)="changePage(currentPage - 1)">
      ä¸Šä¸€é 
    </button>

    <button *ngFor="let page of getPageNumbers()" 
            class="page-btn" 
            [class.active]="page === currentPage"
            (click)="changePage(page)">
      {{ page }}
    </button>

    <button class="page-btn" 
            [disabled]="currentPage === totalPages" 
            (click)="changePage(currentPage + 1)">
      ä¸‹ä¸€é 
    </button>

    <div class="page-info">
      ç¬¬ {{ currentPage }} é ï¼Œå…± {{ totalPages }} é 
      ({{ filteredChanges.length }} ç­†è¨˜éŒ„)
    </div>
  </div>
</div>